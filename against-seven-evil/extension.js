game.import("extension",function(lib,game,ui,get,ai,_status){return {name:"抗七阴",content:function (config,pack){
    
},precontent:function (){
    
},help:{},config:{},package:{
    character:{
        character:{
            "界洛水仙子":["female","wei",6,["boss_jiguan","tashui","lingbo","jiaoxia","fanghua","reluoshen"],["zhu","boss","bossallowed"]],
            "界魏武大帝":["male","wei",12,["boss_guixin","xiongcai","boss_jiguan"],["zhu","boss","bossallowed"]],
            "界孟婆":["female","shen",8,["boss_shiyou","boss_wangshi","boss_didong","boss_guimei"],["zhu","boss","bossallowed"]],
            "孟泰山":["female","shen",8,["boss_shiyou","boss_wangshi","boss_fudu","boss_kujiu"],["zhu","boss","bossallowed"]],
            "朱雀星君":["male","wu",10,["huoshen","boss_honglian","boss_xianyin","boss_zhaohuo","boss_honglianx","boss_jiguan"],["zhu","boss","bossallowed"]],
            "界药坛圣手":["male","qun",6,["chulao","mazui","boss_shengshou","guizhen","wuqin","boss_jiguan"],["zhu","boss","bossallowed"]],
            "虎牢关吕布":["male","qun",8,["mashu","wushuang","xiuluo","shenji","shenqu","jiwu"],["zhu","boss","bossallowed"]],
            "最强年兽":["male","shen",4,["boss_nianrui","boss_mengtai","boss_jingjue","boss_renxing","boss_ruizhi","boss_nbaonu","boss_shouyi"],["zhu","boss","bossallowed"]],
            "界异乡孤女":["female","wei","1/10",["boss_hujia","归汉","rebeige"],["zhu","boss","bossallowed"]],
            "界魔王":["male","qun",20,["boss_qiangzheng","boss_baolin","oljiuchi","roulin","boss_zhiwang"],["zhu","boss","bossallowed"]],
            "转轮地藏":["male","shen",8,["boss_bufo","boss_wuliang","boss_dayuan","boss_diting","boss_modao","boss_lunhui","boss_wangsheng","boss_zlfanshi"],["zhu","boss","bossallowed"]],
            "张叡":["male","shen",4,["xinleiji","xinguidao","xinhuangtian","huituo","xingshuai"],["zhu","boss","bossallowed"]],
            "界绝代妖姬":["female","qun","7/8",["fengwu","yunshen","lianji","boss_wange","yuehun","lijian","rebiyue"],["zhu","boss","bossallowed"]],
            "魏国机械":["none","wei",15,["boss_jiguan","boss_nailuo","boss_didongjg","boss_lianyujg","boss_tunshi","boss_tanshi"],["zhu","boss","bossallowed"]],
            "蜀国机械":["none","shu",10,["boss_jiguan","boss_yuhuojg","boss_tianyun","boss_zhenwei","yizhong","boss_lingyu","boss_mojianjg"],["zhu","boss","bossallowed"]],
            "魏国英魂":["male","wei",8,["boss_xuanlei","boss_skonghun","boss_chiying","boss_chuanyun","boss_leili","boss_fengxing","boss_jueji"],["zhu","boss","bossallowed"]],
            "驭世之奇士":["male","wei",4,["boss_dayuan","tiandu","boss_guimou","boss_yuance","boss_qizuo"],["zhu","boss","bossallowed"]],
            "拼点王":["male","shen",4,["xinfenyue","zhuandui","tianbian","tianyi","hanzhan"],["zhu","boss","bossallowed"]],
            "界奇智女杰":["female","shen",4,["boss_zhinang","boss_jingmiao","boss_jizhi","qicai","boss_guiyin","boss_gongshen"],["zhu","boss","bossallowed"]],
            "扁平度":["male","shen",8,["boss_leizhou","boss_leifu","boss_remen","boss_zhifen","boss_suozu","boss_abi"],["zhu","boss","bossallowed"]],
            "界蜀汉烈帝":["male","shu",12,["chuiti","xiaoxiong","boss_zhangwu","boss_guimei"],["zhu","boss","bossallowed"]],
            "弃牌之神":["male","shen",1,["chuiti","buqu","fenji","qinyin","relonghun","xinjuejing"],["zhu","boss","bossallowed"]],
            "神黄盖":["male","wu",4,["kurou","zhaxiang"],["zhu","boss","bossallowed"]],
            "融赵云":["male","shen",4,["olyajiao","xinjuejing","relonghun","zhanjiang","ollongdan","chongzhen","fenji"],["zhu","boss","bossallowed"]],
            "魅魔":["female","shen",6,["meihun","rebiyue","yuehun","yunshen","boss_guimei","驭心"],["zhu","boss","bossallowed"]],
            "界嬴政":["male","daqin",10,["shangyang_kencao","yingzheng_yitong","yingzheng_shihuang","yingzheng_zulong","yingzheng_fenshu","神护"],["zhu","boss","bossallowed"]],
            "界赵姬":["female","daqin",6,["zhaoji_shanwu","zhaoji_xianji","zhaoji_huoluan","shangyang_kencao","神护","大期"],["zhu","boss","bossallowed"]],
            "界吕不韦":["male","daqin",8,["lvbuwei_jugu","lvbuwei_qihuo","lvbuwei_chunqiu","lvbuwei_baixiang","xinfu_sanwen","神护"],["zhu","boss","bossallowed"]],
            "界张仪":["male","daqin",8,["tiandu","zhangyi_lianheng","zhangyi_xiongbian","巧舌","神护","界戏楚","zhangyi_xichu"],["zhu","boss","bossallowed"]],
            "界白起":["male","daqin",8,["bubing_fangzhen","qibing_liangju","shangyang_kencao","baiqi_wuan","baiqi_shashen","baiqi_fachu","baiqi_changsheng","神护","qibing_changjian","nushou_jinnu"],["zhu","boss","bossallowed"]],
            "回血死":["male","shen",25,["boss_fudu","boss_kujiu","boss_duqu","boss_echou","zhaogao_haizhong"],["zhu","boss","bossallowed"]],
            "苟":["male","shen",10,["exmingshi","extuilangall","神护"],["zhu","boss","bossallowed"]],
            "神赵襄":["female","shu",4,["exmeiluo","boss_mojianjg","神护"],["zhu","boss","bossallowed"]],
            "融甘宁":["male","wu",8,["gnjinfan","gnsheque","yinling","junwei","drlt_poxi","drlt_jieying","qixi"],["zhu","boss","bossallowed"]],
            "融张角":["male","qun",4,["xinleiji","xinguidao","exleimingx","exguidao"],["zhu","boss","bossallowed"]],
            "界sk神曹操":["male","wei",4,["jlsg_guixin","jlsg_feiying","神护"],["zhu","boss","bossallowed"]],
            "神徐晃":["male","wei",6,["shipo","饥荒","神护","olduanliang","oljiezi"],["zhu","boss","bossallowed"]],
            "晋国之祖":["male","jin",4,["lianpo","jlsg_jilve","jlsg_tongtian","jlsg_guicai","jlsg_langgu","jlsg_zhuizun"],["zhu","boss","bossallowed"]],
            "神小偷":["male","shen",4,["jlsgsy_huangyin","jlsgsy_canlue","神护","olxingshen"],["zhu","boss","bossallowed"]],
            "界黄舞蝶":["female","shu",6,["xiwu","神护","hongzhuang"],["zhu","boss","bossallowed","des:就你叫牌王啊"]],
            "界曹金玉":["female","wei",12,["神护","界善身","界隅泣","界娴静"],["zhu","boss","bossallowed"]],
            "界神荀彧":["male","wei",10,["tianzuo","lingce","dinghan","rejieming","qice"],["zhu","boss","bossallowed"]],
            "界☼神貂蝉":["female","qun",8,["lyzyuhun","lyzhuanmei","神护"],["zhu","boss","bossallowed"]],
            "界☼神吕布":["male","qun","8/10",["lyznuozhan","lyzzhenguan","lyzxiaohu","mashu","wushuang"],["zhu","boss","bossallowed"]],
            "界☼赵云":["male","shu",5,["lyzlongying","lyzhunyou","lyzcuizhen","lyzchengyu","神护"],["zhu","boss","bossallowed"]],
            "界☼神司马懿":["male","shen",8,["lyzchouyi","lyztianqian","lyzdikun","lyzguiyuan","神护","exmingshi"],["zhu","boss","bossallowed"]],
            "融神张辽":["male","wei",10,["lyzcuifeng","lyzxiasha","lyzzhijue","drlt_duorui","drlt_zhiti","olduorui","olzhiti","神护"],["zhu","boss","bossallowed"]],
            "界☼神张辽":["male","wei","10/12",["lyzcuifeng","lyzxiasha","lyzzhijue","神护"],["zhu","boss","bossallowed"]],
            "蛮王":["male","qun",10,["equan","manji","hmmanyi","mansi","spxiangzhen","huoshou","zaiqixx","神护","juxiang","hanyong"],["zhu","boss","bossallowed"]],
            "神魏延":["male","shu",4,["xinkuanggu","jlsgsy_shiao","jlsgsy_fangu","jlsgsy_kuangxi"],["zhu","boss","bossallowed"]],
            "界阴蔡夫人":["female","qun",4,["神护","yinjike","窃耳"],[]],
            "界阴荀攸":["male","wei",6,["神护","yinqice","jingzhi","miaomou"],["zhu","boss","bossallowed"]],
            "界阴马超":["male","shu",5,["yintieqi","yinduchou","yinshenyu","神护"],["zhu","boss","bossallowed"]],
            "界阴神吕布":["male","shen",8,["gaiwumou","gaifutu","gaishenfen","界狂暴","神护"],["zhu","boss","bossallowed"]],
            "界阴许邵":["male","qun",12,["gaipingjian","gaishilun","神护"],["zhu","boss","bossallowed"]],
            "界神孙策":["male","shen","1/8",["hunzi","boss_jiang","神护","yingba","scfuhai","冯河"],["zhu","boss","bossallowed"]],
            "神司马炎":["male","jin",4,["逼禅","八王","神护"],["zhu","boss","bossallowed","des:三分一统"]],
        },
        translate:{
            "界洛水仙子":"界洛水仙子",
            "界魏武大帝":"界魏武大帝",
            "界孟婆":"界孟婆",
            "孟泰山":"孟泰山",
            "朱雀星君":"朱雀星君",
            "界药坛圣手":"界药坛圣手",
            "虎牢关吕布":"虎牢关吕布",
            "最强年兽":"最强年兽",
            "界异乡孤女":"界异乡孤女",
            "界魔王":"界魔王",
            "转轮地藏":"转轮地藏",
            "张叡":"张叡",
            "界绝代妖姬":"界绝代妖姬",
            "魏国机械":"魏国机械",
            "蜀国机械":"蜀国机械",
            "魏国英魂":"魏国英魂",
            "驭世之奇士":"驭世之奇士",
            "拼点王":"拼点王",
            "界奇智女杰":"界奇智女杰",
            "扁平度":"扁平度",
            "界蜀汉烈帝":"界蜀汉烈帝",
            "弃牌之神":"弃牌之神",
            "神黄盖":"神黄盖",
            "融赵云":"融赵云",
            "魅魔":"魅魔",
            "界嬴政":"界嬴政",
            "界赵姬":"界赵姬",
            "界吕不韦":"界吕不韦",
            "界张仪":"界张仪",
            "界白起":"界白起",
            "回血死":"回血死",
            "苟":"苟",
            "神赵襄":"神赵襄",
            "融甘宁":"融甘宁",
            "融张角":"融张角",
            "界sk神曹操":"界sk神曹操",
            "神徐晃":"神徐晃",
            "晋国之祖":"晋国之祖",
            "神小偷":"神小偷",
            "界黄舞蝶":"界黄舞蝶",
            "界曹金玉":"界曹金玉",
            "界神荀彧":"界神荀彧",
            "界☼神貂蝉":"界☼神貂蝉",
            "界☼神吕布":"界☼神吕布",
            "界☼赵云":"界☼赵云",
            "界☼神司马懿":"界☼神司马懿",
            "融神张辽":"融神张辽",
            "界☼神张辽":"界☼神张辽",
            "蛮王":"蛮王",
            "神魏延":"神魏延",
            "界阴蔡夫人":"界阴蔡夫人",
            "界阴荀攸":"界阴荀攸",
            "界阴马超":"界阴马超",
            "界阴神吕布":"界阴神吕布",
            "界阴许邵":"界阴许邵",
            "界神孙策":"界神孙策",
            "神司马炎":"神司马炎",
        },
    },
    card:{
        card:{
        },
        translate:{
        },
        list:[],
    },
    skill:{
        skill:{
            "归汉":{
                audio:"ext:无名扩展:2",
                unique:true,
                enable:"chooseToUse",
                mark:true,
                derivation:["tinqin","boss_huixin"],
                init:function (player){
        player.storage.boss_guihan=false;
    },
                filter:function (event,player){
        if(event.type!='dying') return false;
        if(!player.isDying()) return false;
        if(player.storage.boss_guihan) return false;
        return true;
    },
                content:function (){
        "step 0"
        player.removeSkill('boss_guihan');
        player.recover(player.maxHp-player.hp);
        player.storage.boss_guihan=true;
        "step 1"
        player.draw(4);
        "step 2"
        

    
        if(game.bossinfo){
            game.bossinfo.loopType=1;
            _status.roundStart=game.boss;
        }
        
        
        player.addSkill('tinqin');
        player.addSkill('boss_huixin');
    },
                ai:{
                    skillTagFilter:function (player){
            if(player.storage.boss_guihan) return false;
        },
                    save:true,
                    result:{
                        player:4,
                    },
                },
                intro:{
                    content:"limited",
                },
            },
            "驭心":{
                audio:"ext:无名扩展:2",
                enable:"phaseUse",
                usable:2,
                filter:function (event,player){
        if(game.countPlayer()<3) return false;
        for(var i of lib.suit){
            if(player.countCards('h',{suit:i})>1) return true;
        }
        return false;
    },
                complexCard:true,
                position:"h",
                filterCard:function (card,player){
        if(!ui.selected.cards.length){
            var suit=get.suit(card);
            return player.countCards('h',function(card2){
                return card!=card2&&get.suit(card2,player)==suit;
            })>0;
        }
        return get.suit(card,player)==get.suit(ui.selected.cards[0],player);
    },
                selectCard:2,
                selectTarget:2,
                filterTarget:function (card,player,target){
        return player!=target;
    },
                multitarget:true,
                multiline:true,
                delay:false,
                check:function (card){
        return 6-get.value(card);
    },
                targetprompt:["拼点发起人","拼点目标"],
                content:function (){
        'step 0'
        player.showCards(cards);
        'step 1'
        var target=targets[0];
        targets.sortBySeat();
        if(target!=targets[0]) cards.reverse();
        for(var i=0;i<targets.length;i++){
            targets[i].gain(cards[i],player,'visible');
            player.$give(cards[i],targets[i]);
        }
        'step 2'
        if(targets[0].canCompare(targets[1])){
            targets[0].chooseToCompare(targets[1]);
        }
        else event.finish();
        'step 3'
        if(result.winner!==targets[0]) targets[0].addMark('huoxin',1);
        if(result.winner!==targets[1]) targets[1].addMark('huoxin',1);
    },
                marktext:"魅",
                intro:{
                    name:"魅惑",
                    "name2":"魅惑",
                    content:"mark",
                },
                group:"huoxin_control",
                ai:{
                    order:1,
                    result:{
                        target:function (player,target){
                if(target.hasMark('huoxin')) return -2;
                return -1;
            },
                    },
                },
            },
            "神护":{
                mod:{
                    targetEnabled:function (card,player,target){
            if(get.type(card)=='delay'){
                return false;
            }
        },
                },
            },
            "大期":{
                audio:"ext:合纵抗秦:true",
                init:function (player){
        if(!player.storage.zhaoji_daqi) player.storage.zhaoji_daqi=0;
    },
                marktext:"期",
                intro:{
                    content:"当前有#个“期”标记",
                },
                trigger:{
                    player:["phaseBefore","phaseJieshuBegin"],
                },
                forced:true,
                filter:function (event,player){
        return player.storage.zhaoji_daqi!=Infinity&&player.storage.zhaoji_daqi>=10;
    },
                content:function (){
        game.log(player,'失去了',player.storage.zhaoji_daqi,'个“期”标记');
        player.storage.zhaoji_daqi=0;
        player.syncStorage('zhaoji_daqi');
        player.unmarkSkill('zhaoji_daqi');
        var hp=player.maxHp-player.hp;
        var card=player.maxHp-player.countCards('h');
        if(hp>0) player.recover(hp);
        if(card>0) player.draw(card);
        player.storage.zhaoji_huoluan=true;
    },
                group:["zhaoji_daqi_damage","zhaoji_daqi_card"],
                subSkill:{
                    damage:{
                        trigger:{
                            player:"damageAfter",
                            source:"damageSource",
                        },
                        audio:"zhaoji_daqi",
                        forced:true,
                        content:function (){
                player.storage.zhaoji_daqi+=trigger.num;
                player.markSkill('zhaoji_daqi');
                game.log(player,'获得了',trigger.num,'个“期”标记');
                player.syncStorage('zhaoji_daqi');
            },
                        sub:true,
                    },
                    card:{
                        audio:"zhaoji_daqi",
                        trigger:{
                            player:["useCard","respond"],
                        },
                        forced:true,
                        content:function (){
                player.storage.zhaoji_daqi++;
                player.markSkill('zhaoji_daqi');
                game.log(player,'获得了1个“期”标记');
                player.syncStorage('zhaoji_daqi');
            },
                        sub:true,
                    },
                },
            },
            "巧舌":{
                audio:"ext:合纵抗秦:true",
                trigger:{
                    global:"judge",
                },
                direct:true,
                content:function (){
        'step 0'
        var card=trigger.player.judging[0];
        var judge0=trigger.judge(card);
        var judge1=0;
        var choice=trigger.no6&&card.number==6?'+1':'cancel2';
        var attitude=get.attitude(player,trigger.player);
        var list=[];
        for(var i=-4;i<5;i++){
            if(i==0) continue;
            list.push((i>0?'+':'')+i);
            if(!trigger.no6){
                var judge2=(trigger.judge({
                    name:get.name(card),
                    suit:get.suit(card),
                    number:get.number(card)+i,
                    nature:get.nature(card),
                })-judge0)*attitude;
                if(judge2>judge1){
                    choice=(i>0?'+':'')+i;
                    judge1=judge2;
                }
            }
        }
        list.push('cancel2');
        player.chooseControl(list).set('ai',function(){
            return _status.event.choice;
        }).set('choice',choice).prompt=get.prompt2(event.name);
        'step 1'
        if(result.control!='cancel2'){
            player.logSkill(event.name,trigger.player);
            game.log(trigger.player,'判定结果点数','#g'+result.control);
            player.popup(result.control,'fire');
            if(!trigger.fixedResult) trigger.fixedResult={};
            if(!trigger.fixedResult.number) trigger.fixedResult.number=get.number(trigger.player.judging[0]);
            trigger.fixedResult.number+=parseInt(result.control);
        }
    },
            },
            "界戏楚":{
                trigger:{
                    player:"phaseJieshuBegin",
                },
                frequent:true,
                content:function (){
        var list=game.filterPlayer(function(target){
            return target!=player&&!target.isMad();
        });
        if(list.length){
            var target=list.randomGet();
            player.line(target,'green');
            target.goMad({player:'phaseAfter'});
        }
    },
            },
            "饥荒":{
                audio:"ext:谋攻篇:2",
                enable:"phaseUse",
                usable:7,
                filterTarget:function (card, player, target) {
        return player != target;
    },
                content:function () {
        'step 0'
        player.chooseControl('围城断粮', '擂鼓进军').set('prompt', '谋弈：请选择你的进攻策略').set('ai', function () {
            if (target.hasJudge('bingliang')) return '擂鼓进军';
            return ['围城断粮', '擂鼓进军'].randomGet();
        });
        'step 1'
        event.res = result.control;
        target.chooseControl('围城断粮', '擂鼓进军').set('prompt', '谋弈：请猜测' + get.translation(player) + '的进攻策略').set('ai', function () {
            if (target.hasJudge('bingliang')) return '擂鼓进军';
            return ['围城断粮', '擂鼓进军'].randomGet();
        });
        'step 2'
        var str;
        player.popup(event.res);
        target.popup(result.control);
        game.log(player, '谋弈', event.res == result.control ? '#y失败' : '#g成功');
        if (event.res != result.control) {
            game.playAudio('..', 'extension', '谋攻篇', 'mouduanliang3');
            str = get.translation(player) + '谋弈成功';
        }
        else {
            game.playAudio('..', 'extension', '谋攻篇', 'mouduanliang4');
            str = get.translation(target) + '谋弈成功';
        }
        game.broadcastAll(function (str) {
            var dialog = ui.create.dialog(str);
            dialog.classList.add('center');
            setTimeout(function () {
                dialog.close();
            }, 1000);
        }, str);
        game.delay(2);
        if (event.res == result.control) event.finish();
        'step 3'
        if (event.res == '围城断粮') {
            if (!target.hasJudge('bingliang')) {player.useCard({ name: 'bingliang' }, get.cards(), target);event.finish();}
            else if(target.countCards('he')>0) event.goto(4);
            else event.finish();
        }
        else {player.useCard({ name: 'juedou', isCard: true }, target, false);event.finish();}
        'step 4'
        player.choosePlayerCard(target, 'he', true, '获得'+get.translation(target)+'的一张牌');
        
        'step 5'
        if (result.bool) {
            player.gain(result.cards, target, 'giveAuto');
        }
    },
                ai:{
                    order:7,
                    result:{
                        target:function (player, target) {
                if (target.hasJudge('bingliang')) return -0.5;
                return -1.5;
            },
                    },
                },
            },
            "界红妆":{
                audio:"ext:谋攻篇:2",
                usable:100,
                trigger:{
                    player:["useCard","respond"],
                },
                frequent:true,
                content:function () {
        player.draw(get.number(trigger.cards[0]));
    },
            },
            "界善身":{
                audio:"ext:无名扩展:2",
                trigger:{
                    global:"die",
                },
                direct:true,
                content:function(){
        'step 0'
        event.goon=!player.hasAllHistory('sourceDamage',function(evt){
            return evt.player==trigger.player;
        });
        player.chooseControl('<span class=thundertext>蓝色</span>','<span class=firetext>红色</span>','<span class=greentext>绿色</span>','<span class=yellowtext>黄色</span>','cancel2').set('prompt',get.prompt('shanshen')).set('prompt2','令〖隅泣〗中的一个数字+2'+(event.goon?'并回复1点体力':'')).set('ai',function(){
            var player=_status.event.player,info=lib.skill.yuqi.getInfo(player);
            if(info[0]<info[3]&&game.countPlayer(function(current){
                return get.distance(player,current)<=info[0];
            })<Math.min(3,game.countPlayer())) return 0;
            if(info[3]<info[1]-1) return 3;
            if(info[1]<10) return 1;
            if(info[0]<10&&game.hasPlayer(function(current){
                return current!=player&&get.distance(player,current)>info[0];
            })) return 0;
            return 2;
        });
        'step 1'
        if(result.control!='cancel2'){
            player.logSkill('shanshen',trigger.player);
            var list=lib.skill.yuqi.getInfo(player);
            list[result.index]=Math.min(10,list[result.index]+2);
            game.log(player,'将',result.control,'数字改为','#y'+list[result.index])
            player.markSkill('yuqi');
            if(event.goon) player.recover();
        }
    },
            },
            "界娴静":{
                audio:"ext:无名扩展:2",
                trigger:{
                    player:"phaseZhunbeiBegin",
                },
                direct:true,
                content:function(){
        'step 0'
        player.chooseControl('<span class=thundertext>蓝色</span>','<span class=firetext>红色</span>','<span class=greentext>绿色</span>','<span class=yellowtext>黄色</span>','cancel2').set('prompt',get.prompt('xianjing')).set('prompt2','令〖隅泣〗中的一个数字+1').set('ai',function(){
            var player=_status.event.player,info=lib.skill.yuqi.getInfo(player);
            if(info[0]<info[3]&&game.countPlayer(function(current){
                return get.distance(player,current)<=info[0];
            })<Math.min(3,game.countPlayer())) return 0;
            if(info[3]<info[1]-1) return 3;
            if(info[1]<10) return 1;
            if(info[0]<10&&game.hasPlayer(function(current){
                return current!=player&&get.distance(player,current)>info[0];
            })) return 0;
            return 2;
        });
        'step 1'
        if(result.control!='cancel2'){
            player.logSkill('xianjing');
            var list=lib.skill.yuqi.getInfo(player);
            list[result.index]=Math.min(10,list[result.index]+1);
            game.log(player,'将',result.control,'数字改为','#y'+list[result.index])
            player.markSkill('yuqi');
            if(player.isDamaged()) event.finish();
        }
        else event.finish();
        'step 2'
        player.chooseControl('<span class=thundertext>蓝色</span>','<span class=firetext>红色</span>','<span class=greentext>绿色</span>','<span class=yellowtext>黄色</span>','cancel2').set('prompt','是否令〖隅泣〗中的一个数字+1？').set('ai',function(){
            var player=_status.event.player,info=lib.skill.yuqi.getInfo(player);
            if(info[0]<info[3]&&game.countPlayer(function(current){
                return get.distance(player,current)<=info[0];
            })<Math.min(3,game.countPlayer())) return 0;
            if(info[3]<info[1]-1) return 3;
            if(info[1]<10) return 1;
            if(info[0]<10&&game.hasPlayer(function(current){
                return current!=player&&get.distance(player,current)>info[0];
            })) return 0;
            return 2;
        });
        'step 3'
        if(result.control!='cancel2'){
            var list=lib.skill.yuqi.getInfo(player);
            list[result.index]=Math.min(10,list[result.index]+1);
            game.log(player,'将',result.control,'数字改为','#y'+list[result.index])
            player.markSkill('yuqi');
        }
    },
            },
            "界隅泣":{
                audio:"ext:无名扩展:2",
                trigger:{
                    global:"damageEnd",
                },
                init:function(player){
        if(!player.storage.yuqi) player.storage.yuqi=[0,3,1,1];
    },
                getInfo:function(player){
        if(!player.storage.yuqi) player.storage.yuqi=[0,3,1,1];
        return player.storage.yuqi;
    },
                onremove:true,
                usable:2,
                filter:function(event,player){
        var list=lib.skill.yuqi.getInfo(player);
        return event.player.isIn()&&get.distance(player,event.player)<=list[0];
    },
                logTarget:"player",
                content:function(){
        'step 0'
        event.list=lib.skill.yuqi.getInfo(player);
        var cards=get.cards(event.list[1]);
        event.cards=cards;
        game.cardsGotoOrdering(cards);
        var next=player.chooseToMove(true,'隅泣（若对话框显示不完整，可下滑操作）');
        next.set('list',[
            ['牌堆顶的牌',cards],
            ['交给'+get.translation(trigger.player)+'（至少一张'+(event.list[2]>1?('，至多'+get.cnNumber(event.list[2])+'张'):'')+'）'],
            ['交给自己（至多'+get.cnNumber(event.list[3])+'张）'],
        ]);
        next.set('filterMove',function(from,to,moved){
            var info=lib.skill.yuqi.getInfo(_status.event.player);
            if(to==1) return moved[1].length<info[2];
            if(to==2) return moved[2].length<info[3];
            return true;
        });
        next.set('processAI',function(list){
            var cards=list[0][1].slice(0).sort(function(a,b){
                return get.value(b,'raw')-get.value(a,'raw');
            }),player=_status.event.player,target=_status.event.getTrigger().player;
            var info=lib.skill.yuqi.getInfo(_status.event.player);
            var cards1=cards.splice(0,Math.min(info[3],cards.length-1));
            var card2;
            if(get.attitude(player,target)>0) card2=cards.shift();
            else card2=cards.pop();
            return [cards,[card2],cards1];
        });
        next.set('filterOk',function(moved){
            return moved[1].length>0;
        });
        'step 1'
        if(result.bool){
            var moved=result.moved;
            cards.removeArray(moved[1]);
            cards.removeArray(moved[2]);
            while(cards.length){
                ui.cardPile.insertBefore(cards.pop().fix(),ui.cardPile.firstChild);
            }
            trigger.player.gain(moved[1],'gain2');
            if(moved[2].length) player.gain(moved[2],'gain2');
            game.updateRoundNumber();
        }
    },
                mark:true,
                intro:{
                    content:function(storage,player){
            var info=lib.skill.yuqi.getInfo(player);
            return '<div class="text center"><span class=thundertext>蓝色：'+info[0]+'</span>　<span class=firetext>红色：'+info[1]+'</span><br><span class=greentext>绿色：'+info[2]+'</span>　<span class=yellowtext>黄色：'+info[3]+'</span></div>'
        },
                },
                ai:{
                    threaten:8.8,
                },
            },
            "窃耳":{
                audio:"ext:阴包武将:2",
                trigger:{
                    global:"phaseEnd",
                },
                filter:function(event,player){
        var target=event.player;
        if(target.getHistory('skipped').contains('phaseUse')) return false;
        return true;
    },
                frequent:true,
                content:function(){
        'step 0'
        player.draw();
        'step 1'
        var target=trigger.player;
        event.target=target;
        event.logged=false;
        ndxl=player.hp+0;
        'step 2'
        if(!target.getHistory('sourceDamage').length>0) player.draw();
        if(player.getHistory('damage').length>1) player.recover();
        'step 3'
        if(target.getHistory('useCard',function(evt){
            return evt.targets&&evt.targets.filter(function(i){
                return i!=target;
            }).length>0;
        }).length!=0) event.finish();
        'step 4'
        player.chooseBool('是否发动【窃耳】令你与当前回合角色各摸X张牌？（X为你的体力值）').set('frequentSkill','yinqieer');
        'step 5'
        if(result.bool){
            if(!event.logged) player.logSkill('yinqieer',target);
            player.draw(ndxl);
           
        }
    },
            },
            "界狂暴":{
                audio:"ext:阴包武将:2",
                trigger:{
                    player:"enterGame",
                    global:"phaseBefore",
                },
                superCharlotte:true,
                charlotte:true,
                forced:true,
                group:"gaikuangbao2",
                filter:function(event){
        return (event.name!='phase'||game.phaseNumber==0); 
    },
                content:function(){
        player.addMark('gaikuangbao',4);
    },
                marktext:"暴怒",
                intro:{
                    name:"暴怒",
                    content:"mark",
                },
                ai:{
                    combo:"gai_shenfen",
                    maixie:true,
                    "maixie_hp":true,
                },
            },
            "冯河":{
                audio:"ext:抗七阴:2",
                mod:{
                    maxHandcardBase:function(player){
            return player.maxHp;
        },
                },
                trigger:{
                    player:"damageBegin2",
                },
                forced:true,
                filter:function(event,player){
        return event.source&&event.source!=player&&player.maxHp>1&&player.countCards('h')>0;
    },
                content:function(){
        'step 0'
        player.chooseCardTarget({
            prompt:'请选择【冯河】的牌和目标',
            prompt2:'将一张手牌交给一名其他角色并防止伤害'+(player.hasSkill('yingba')?'，然后令伤害来源获得一个“平定”标记':''),
            filterCard:true,
            forced:false,
            filterTarget:lib.filter.notMe,
            ai1:function(card){
                if(get.tag(card,'recover')&&!game.hasPlayer(function(current){
                    return get.attitude(current,player)>0&&!current.hasSkillTag('nogain');
                })) return 0;
                return 1/Math.max(0.1,get.value(card));
            },
            ai2:function(target){
                var player=_status.event.player,att=get.attitude(player,target);
                if(target.hasSkillTag('nogain')) att/=9;
                return 4+att;
            },
        });
        'step 1'
        if(result.bool){
            var target=result.targets[0];
            //player.logSkill('pinghe',target);
            player.line(target,'green');
            target.gain(result.cards,player,'giveAuto');
            trigger.cancel();
            player.loseMaxHp();
            if(player.hasSkill('yingba')){
                trigger.source.addMark('yingba_mark',1);
            }
        }
    },
            },
            "逼禅":{
                audio:"dengji",
                enable:"phaseUse",
                usable:1,
                filterTarget:function (card, player, target) {
        if (target.countCards('e') <= 0) return false;
        return player != target;
    },
                content:function () {
        var card = target.getCards('e');
        for (var i = 0; i < card.length; i++) {
            player.equip(card[i]);
        }
        target.draw(card.length);
        target.damage(6-card.length);
    },
                ai:{
                    order:13,
                    result:{
                        target:function (player, target) {
                if (!target.countCards('e')) return 0;
                return -1;
            },
                    },
                    threaten:1,
                },
            },
            "八王":{
                audio:"sbaiyin",
                enable:"phaseUse",
                filter:function (event, player) {
        return player.countMark('ymbawang') > 0;
    },
                filterTarget:function (card, player, target) {
        if (target.hasMark('ymbawang')) return false;
        return player != target > 0;
    },
                content:function () {
        player.removeMark('ymbawang', 1);
        target.addMark('ymbawang', 1);
    },
                marktext:"王",
                intro:{
                    name:"八王",
                },
                ai:{
                    order:11,
                    result:{
                        target:function (player, target) {
                /*if ((player.countMark('ymbawang') >= 2 || !game.hasPlayer(function (current) {
                    return current != player && get.attitude(player, current) < 0 && current.hasMark('ymbawang');
                })) && player.countCards('h', function (card) {
                    return get.tag(card, 'damage') && player.canUse(card, target, null, true) && player.getUseValue(card) > 0 && get.effect_use(target, card, player) > 0 && target.hasSkillTag('filterDamage', null, {
                        player: player,
                        card: card,
                    });
                })) return 3 / Math.max(1, target.hp);
                if ((!player.hasUnknown() && game.countPlayer(function (current) {
                    return get.attitude(player, current) < 0;
                }) <= 1) || player.countMark('ymbawang') >= 2) {
                    return -1;
                }
                return 0;*/
                return -1;
            },
                    },
                    effect:{
                        player:function (card, player, target) {
                if (player != target && get.tag(card, 'damage') && target && target.hasMark('ymbawang') && !target.hasSkillTag('filterDamage', null, {
                    player: player,
                    card: card,
                })) return [1, 0, 1, -2];
            },
                    },
                    threaten:0.8,
                },
                group:["ymbawang_start","ymbawang_what"],
                subSkill:{
                    start:{
                        audio:"sbaiyin",
                        trigger:{
                            global:["gameStart","roundStart"],
                            player:"enterGame",
                        },
                        forced:true,
                        filter:function(event,player,name){
                if(name=='roundStart') return true;
                return true;
            },
                        content:function () {
                if(event.triggername=='gameStart') player.addMark("ymbawang", 8);
                else player.addMark("ymbawang", 1);
            },
                        sub:true,
                    },
                    what:{
                        trigger:{
                            source:["damageBegin1"],
                            player:"damageBegin",
                            global:["drawEnd"],
                        },
                        forced:true,
                        unique:true,
                        charlotte:true,
                        silent:true,
                        popup:false,
                        filter:function (event, player, name) {
                if (name == 'damageBegin1') return event.player!=player&&event.player.hasMark('ymbawang');
                else if (name == 'damageBegin'){
                    if(game.findPlayer(function (current) {
                        if (current.hasMark('ymbawang') && current != player) return true;
                    })) return true;
                }
                else if (name == 'drawEnd'){
                    if (player.getHistory('gain', function (evt) {
                        return evt.getParent().name=='draw'&&evt.getParent(2).name=='ymbawang_what'
                    }).length > 0) return false;
                    return event.player!=player&&event.player.hasMark('ymbawang');
                }
            },
                        content:function () {
                var name = event.triggername;
                if (name == 'damageBegin') {
                    var players=[];
                    game.findPlayer(function (current) {
                        if (current.hasMark('ymbawang') && current != player) players.add(current);
                    });
                    var own=players.randomGet();
                    trigger.player=own;
                    game.log(player,'将伤害转移给了',own);
                    own.removeMark('ymbawang',1);
                }
               else if(name == 'damageBegin1'){
                   trigger.num++;
               }
               else if(name == 'drawEnd'){
                   player.draw(trigger.num);
               }
            },
                        sub:true,
                    },
                },
            },
        },
        translate:{
            "归汉":"归汉",
            "归汉_info":"限定技，濒死阶段，你可以将体力回复至体力上限，摸4张牌，获得技能【听琴】、【蕙质】",
            "驭心":"驭心",
            "驭心_info":"出牌阶段限两次，你可以展示两张花色相同的手牌并分别交给两名其他角色，然后令这两名角色拼点，没赢的角色获得1个“魅惑”标记。拥有2个或更多“魅惑”的角色回合即将开始时，该角色移去其所有“魅惑”，此回合改为由你操控。",
            "神护":"神护",
            "神护_info":"锁定技，你不能成为延时类锦囊的目标",
            "大期":"大期",
            "大期_info":"锁定技，你每使用或打出一张手牌、造成1点伤害、受到1点伤害，均会得到一个“期”标记。你的回合开始时，若你拥有的“期”标记。",
            "巧舌":"巧舌",
            "巧舌_info":"当一名角色进行判定时，你可以令判定结果的点数加减4以内的任意值。",
            "界戏楚":"界戏楚",
            "界戏楚_info":"结束阶段，你可以令一名随机的其他角色进入混乱状态直到其下一回合结束",
            "饥荒":"饥荒",
            "饥荒_info":"出牌阶段限七次，你可以与一名其他角色进行“谋弈”：<br>围城断粮：若其判定区有【兵粮寸断】，获得其一张牌，否则你将一张牌堆顶的牌当做【兵粮寸断】对其使用且无距离限制。<br>擂鼓进军：你视为对其使用一张【决斗】。",
            "界红妆":"界红妆",
            "界红妆_info":"每名角色的回合限一百次，当你使用或打出一张牌时，你可以摸X张牌（X为此牌点数）。",
            "界善身":"界善身",
            "界善身_info":"当有角色死亡时，你可令你的〖隅泣〗中的一个具有颜色的数字+2。然后若你未对该角色造成过伤害，则你回复1点体力。",
            "界娴静":"界娴静",
            "界娴静_info":"准备阶段，你可令你的〖隅泣〗中的一个具有颜色的数字+1。若你的体力值等于体力上限，则你可以重复一次此流程。",
            "界隅泣":"界隅泣",
            "界隅泣_info":"每回合限两次。当有角色受到伤害后，若你至其的距离不大于<span class=thundertext>0</span>，则你可以观看牌堆顶的<span class=firetext>3</span>张牌。你将其中至多<span class=greentext>1</span>张牌交给受伤角色，然后可以获得剩余牌中的至多<span class=yellowtext>1</span>张牌，并将其余牌以原顺序放回牌堆顶。（所有具有颜色的数字至多为10）",
            "窃耳":"窃耳",
            "窃耳_info":"一名角色的结束阶段，若其未跳过出牌阶段，则你可以摸一张牌，然后该回合内：其没有造成伤害，你摸一张牌;你受到伤害次数大于1，你回复一点体力;其未对其他角色使用过牌，你可以与其(若当前回合角色为你则只摸一次)各摸X张牌。（X为你的体力值）",
            "界狂暴":"界狂暴",
            "界狂暴_info":"锁定技，游戏开始时，你获得4枚“暴怒”；当你造成或受到1点伤害后，你获得1枚“暴怒”。",
            "冯河":"冯河",
            "冯河_info":"①锁定技，你的手牌上限基数等于你的体力上限。②当你受到其他角色造成的伤害时，若你有牌且你的体力上限大于1，则你防止此伤害，减一点体力上限并将一张手牌交给一名其他角色。然后若你拥有〖英霸〗，则伤害来源获得一个“平定”标记。",
            "逼禅":"逼禅",
            "逼禅_info":"出牌阶段限一次，你可以指定一名装备区有牌的其他角色将其装备区里的所有牌移至你的装备区，然后该角色摸等量张牌并受到X点伤害。(X为6-移动的牌数)",
            "八王":"八王",
            "八王_info":"锁定技，游戏开始时，你获得8个“王”标记，每进行一轮游戏时，你获得1个“王”标记；出牌阶段，你可以将一个“王”标记交给一名其他角色；锁定技，拥有“王”标记的其他角色摸牌后你摸等量张牌(每回合限一次)且你对其他拥有“王”标记的角色造成的伤害+1，当你受到伤害时，此伤害转移至场上随机一名拥有“ 王”标记的角色，然后其移除一个此标记。",
        },
    },
    intro:"",
    author:"SNORLAX",
    diskURL:"",
    forumURL:"",
    version:"1.0",
},files:{"character":["神司马炎.jpg"],"card":[],"skill":[]}}})